<link href="js/jquery.multi-select.css" media="screen" rel="stylesheet" type="text/css">
<script src="js/jquery.multi-select.js" type="text/javascript"></script>
<!-- http://loudev.com/#project -->
<fieldset>
    <legend><h3>Despatch Register</h3></legend>
    <form method="post">
        <table>
            <tr>
                <td>Start</td>
                <td><input type="date" name="start_date" size="9" placeholder="dd-mm-yyyy" value='{$smarty.request.start_date}' /></td>
                <td>End</td>
                <td><input type="date" name="end_date" size="9"  placeholder="dd-mm-yyyy" value='{$smarty.request.end_date}' /></td>
                <td>Vehicle Type</td>
                <td><input type="text" name="ownveh" size="1" value='{$smarty.request.ownveh}' /></td>
                <td>Vehicle No.</td>
                <td><input type="text" name="vehno" size="12" value='{$smarty.request.vehno}' /></td>
                <td>
                    <input type="checkbox" value="1" name="truckdetail" {if $smarty.request.truckdetail=="1"}checked="checked"{/if} value='{$smarty.request.truckdetail}' />Truck Details<br>
                    <input type="checkbox" value="1" name="ddac" {if $smarty.request.ddac=="1"}checked="checked"{/if} value='{$smarty.request.ddac}' />DD & AC
                </td>
                <td>Order</td>
                <td>
                    <select name="order">
                        <option value="D" {if $smarty.request.order=="D"}selected="selected"{/if}>Date-wise</option>
                        <option value="C" {if $smarty.request.order=="C"}selected="selected"{/if}>Company-wise</option>
                        <option value="A" {if $smarty.request.order=="A"}selected="selected"{/if}>Area-wise</option>
                        <option value="B" {if $smarty.request.order=="B"}selected="selected"{/if}>Bill No.-wise</option>
                        <option value="L" {if $smarty.request.order=="L"}selected="selected"{/if}>L/c No-wise</option>
                        <option value="V" {if $smarty.request.order=="V"}selected="selected"{/if}>Vehicle-wise</option>
                    </select>
                </td>
                <td>
                    <input class="btn btn-primary" type="submit" value="Go" />
                    <input class="btn btn-primary" type="button" class="print" value="Print" />
                    <input type="hidden" id="excelfile" value="despatchregister" />
                    <input class="btn btn-primary" type="button" class="excel" value="Download" title="Download as Excel" />
                </td>
            </tr>
            <tr>
                <td>Company</td>
                <td colspan="4"><select id="company" name="company[]" multiple="multiple">
                    <option value="0">All Company</option>
                    {html_options options=$company} 
                    </select>
                </td>
                <td>Area</td>
                <td colspan="3"><select id="area" name="area[]" multiple="multiple">
                    <option value="0">All Area</option>
                    {html_options  options=$area}
                </select>
                </td>
            </tr>
        </table>
    </form>
</fieldset>
<br />
<div class="print_content">
    {$smarty.session.cname} {$smarty.session.fyear}<br>
    Despatch Register Period {$smarty.request.start_date|date_format:"%d-%m-%Y"} - {$smarty.request.end_date|date_format:"%d-%m-%Y"}<br />
    <table id='report' border="1">
        <!-- IF desorder="Vehicle-wise"
	retdata = "Date  Lc No   Destination Inv No     Date  LR No   Weight    Qty"
ELSE
	retdata = "Date  Truck No        Lc No   Company      Destination Inv No     Date  LR No   Weight    Qty"
ENDIF
retdata = retdata + IIF(_super,"  Freight","")
retdata = retdata + IIF(destruck," Truck Fr  Advance  V.No   Balance    Other   TDS AMT  V.Dt  V.No ","")
retdata = retdata + " Remark              "
retdata = retdata + IIF(desdd, " Deli  Ack.  ","") -->
        <tr>
            <th>Sl</th><th>Date</th><th>Company</th><th>LC No.</th><th>Destination</th><th>Lrno</th><th>Inv. No.</th><th>Date</th>
            <th>Weight</th><th>Qty</th><th>Freight</th><th colspan="2">Del. Ack.</th>
        </tr>
        {$weight=0}{$qty=0}{$freight=0}
        {$s=1}
        {foreach item=x name=it from=$data}
            <tr>
                <td>{$s}{$s=$s+1}</td>
                <td>{$x.date|date_format:"%d-%m-%Y"}</td>
                <td>{$x.cname}</td>
                <td>{$x.no}</td>
                <td>{$x.aname}</td>
                <td>{$x.lrno}</td>
                <td>{$x.bno}</td>
                <td>{$x.bnodate|date_format:"%d-%m-%Y"}</td>
                <td align="right">{$x.weight}</td>
                <td align="right">{$x.qty|string_format:"%.0f"}</td>
                <td align="right">{$x.freight|string_format:"%.2f"}</td>
                <td>{$x.ddate|date_format:"%d-%m-%Y"}</td>
                <td>{$x.ack}</td>
                {$weight=$weight+$x.weight}
                {$qty=$qty+$x.qty}
                {$freight=$freight+$x.freight}
            </tr>


<!-- 
            DO WHILE !EOF()
            STORE 0 TO twt, tqty, tfr
            grp1 = DTOS(idate)+invno
            DO WHILE grp1 = DTOS(idate)+invno AND !EOF()
                IF desorder="Vehicle-wise"
                    ?LEFT(DTOC(idate),5), PADL(ALLT(no),5), loading, ;
                     PADL(area.name,11), bno, LEFT(DTOC(bnodate),5), PADL(ALLT(lrno),6), ;
                     weight PICT "999.999", qty PICT "999999"
                ELSE
                    ?LEFT(DTOC(idate),5), vehno, PADL(ALLT(no),5), loading, LEFT(company.name,12), ;
                     PADL(area.name,11), bno, LEFT(DTOC(bnodate),5), PADL(ALLT(lrno),6), ;
                     weight PICT "999.999", qty PICT "999999"
                ENDIF
                twt = twt + weight
                tqty = tqty + qty
                rwt = rwt + weight
                rqty = rqty + qty
                IF _super
                    ??freight PICT "999999.99"
                    tfr = tfr + freight
                ENDIF
                SKIP
            ENDDO
            SKIP -1
            ?CHR(27)+CHR(71), "TOTAL :" AT printatpos, twt PICT "9999.999", tqty PICT "999999"
            IF _super
                ??tfr PICT "999999.99"
            ENDIF
            IF destruck
                ??tfreight PICT "999999.99", advance PICT "99999.99", ;
                  vno, balance PICT "99999.99", other PICT "99999.99", ;
                  IIF(TYPE("tdsamt")="N", tdsamt, 0) PICT "999999.99", ;
                  LEFT(DTOC(odate),5), ovno
            ENDIF
            ?? " "+PADL(narration, 20)
            IF desdd
                ??" "+LEFT(DTOC(ddate),5), LEFT(ack,6)
            ENDIF
            ??CHR(27)+CHR(72)
            rfr = rfr + tfr
            rtfr = rtfr + tfreight
            radv = radv + advance
            rbal = rbal + balance
            roth = roth + other
            rtdsamt = rtdsamt + IIF(TYPE("tdsamt")="N", tdsamt, 0)
            SKIP
        ENDDO -->

        {/foreach}
        <tr>
            <th colspan="8">Total :</th>
            <td align="right"><b>{$weight|string_format:"%.2f"}</b></td>
            <td align="right"><b>{$qty|string_format:"%.0f"}</b></td>
            <td align="right"><b>{$freight|string_format:"%.2f"}</b></td>
        </tr>
    </table>
</div>
<script>
    $(document).ready(function () {
        $('#area').multiSelect();
        $('#company').multiSelect();
    });
</script>